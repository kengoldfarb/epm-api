# Welcome to Serverless!
#
# This file is the main config file for your service.
# It's very minimal at this point and uses default values.
# You can always add more config options for more control.
# We've included some commented out config examples here.
# Just uncomment any of them to get that config option.
#
# For full config options, check the docs:
#    docs.serverless.com
#
# Happy Coding!

service: meem-api

provider:
  name: aws
  runtime: nodejs14.x
  memorySize: 256
  timeout: 30
  # logs:
  #   websocket: true
  environment:
    SERVERLESS: true
    LOG_LEVEL: ${env:LOG_LEVEL, 'debug'}
    ENABLE_REQUEST_LOGGING: ${env:ENABLE_REQUEST_LOGGING, 'false'}
    ORM_DISABLE: ${env:ORM_DISABLE, 'true'}
    INFURA_ID: ${env:INFURA_ID, ''}
    MEEM_PROXY_ADDRESS: ${env:MEEM_PROXY_ADDRESS, ''}
    NETWORK: ${env:NETWORK, ''}
    WALLET_PRIVATE_KEY: ${env:WALLET_PRIVATE_KEY, ''}
    GENERATE_SHARED_TYPES: ${env:GENERATE_SHARED_TYPES, 'false'}
    GITHUB_KEY: ${env:GITHUB_KEY, ''}
    CORS_ALLOW_ALL: ${env:CORS_ALLOW_ALL, 'true'}

package:
  excludeDevDependencies: true
  include:
    - build/**
    - src/types/meem.generated.ts
    - src/lib/meem-badge.png
  exclude:
    - .circleci/**
    - .vscode/**
    - backup/**
    - coverage/**
    - docker/**
    - docs/**
    - load-testing/**
    - scripts/**
    - src/**
    - tmp/**

functions:
  mint:
    handler: build/serverless/mint.handle
  catchAll:
    handler: build/serverless/handler.handle
    events:
      - httpApi: '*'
  sockets:
    handler: build/serverless/socket.handle
    events:
      - websocket: $connect
      - websocket: $disconnect
      - websocket: $default
  # cron:
  #   handler: build/serverless/cron.handle
  #   timeout: 600
  #   events:
  #     - schedule:
  #         rate: rate(30 minutes)
  #         # CHANGE THIS TO "true" TO RUN CRONS
  #         enabled: false
  #         input:
  #           job: TestCron

